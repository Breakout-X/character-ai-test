<!DOCTYPE html>
<html>
<head>
    <title>Image Generator</title>
    <style>
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <input type="text" id="command" placeholder="Enter command here">
    <button onclick="generateImage()">Generate Image</button>

    <script type="module" src="https://cdn.jsdelivr.net/gh/Breakout-X/character-ai-test@main/AI/Orion-v1/badwords.js" onerror="An error occurred in loading 'badwords.js'. Please refresh the page."></script>
    <script onerror="An unknown error occured. Please refresh the page and try again">
        // Function to generate the image based on the command
        function generateImage() {
            // Get the command from the input field
            let command = document.getElementById('command').value;

            // Check for inappropriate words
            for (let word of window.inappropriateWords) {
                if (command.includes(word)) {
                    displayImage("https://breakout-x.github.io/character-ai-test/img/ELedlow-the-male-fox-blocked-content-screen.png");
                    return;
                }
            }

            // Parse the command
            let parts = command.split(" ");
            let actionIndex = parts.indexOf("in") - 1;
            let action = parts.slice(actionIndex - 1, actionIndex + 1).join("-");
            let gender = parts[actionIndex - 2];
            let color = parts[actionIndex - 3];
            let animal = parts[actionIndex - 4];
            let setting = parts[actionIndex + 1];

            // Check if there is a second animal
            let andIndex = parts.indexOf("and");
            let secondAnimal = null;
            if (andIndex !== -1) {
                let secondGender = parts[andIndex + 1];
                let secondColor = parts[andIndex + 2];
                let secondAnimal = parts[andIndex + 3];
                let secondAction = parts[andIndex + 4] + "-" + parts[andIndex + 5];
                secondAnimal = secondGender + "-" + secondAnimal + "-" + secondAction + ".png";
            }

            // Create the image names
            let background = setting + ".png";
            let animalImage = gender + "-" + animal + "-" + action + ".png";

            // Load the images
            loadImage(background, function(bgImage) {
                loadImage(animalImage, function(animalImg) {
                    // Create a canvas and get the context
                    let canvas = document.createElement('canvas');
                    canvas.width = 200;  // Set canvas width
                    canvas.height = 200; // Set canvas height
                    let ctx = canvas.getContext('2d');

                    // Draw the background image
                    ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);

                    // Create a second canvas for the animal image
                    let animalCanvas = document.createElement('canvas');
                    let animalCtx = animalCanvas.getContext('2d');

                    // Draw the animal image
                    animalCtx.drawImage(animalImg, 0, 0, animalCanvas.width, animalCanvas.height);

                    // Tint the animal image
                    animalCtx.fillStyle = color;
                    animalCtx.globalCompositeOperation = "multiply";
                    animalCtx.fillRect(0, 0, animalCanvas.width, animalCanvas.height);
                    animalCtx.globalCompositeOperation = "source-over";

                    // Draw the tinted animal image onto the main canvas
                    ctx.drawImage(animalCanvas, 0, 0, canvas.width, canvas.height);

                    // If there is a second animal, load its image
                    if (secondAnimal) {
                        loadImage(secondAnimal, function(secondAnimalImg) {
                            // Create a third canvas for the second animal image
                            let secondAnimalCanvas = document.createElement('canvas');
                            let secondAnimalCtx = secondAnimalCanvas.getContext('2d');

                            // Draw the second animal image
                            secondAnimalCtx.drawImage(secondAnimalImg, 0, 0, secondAnimalCanvas.width, secondAnimalCanvas.height);

                            // Tint the second animal image
                            secondAnimalCtx.fillStyle = secondColor;
                            secondAnimalCtx.globalCompositeOperation = "multiply";
                            secondAnimalCtx.fillRect(0, 0, secondAnimalCanvas.width, secondAnimalCanvas.height);
                            secondAnimalCtx.globalCompositeOperation = "source-over";

                            // Draw the tinted second animal image onto the main canvas
                            ctx.drawImage(secondAnimalCanvas, 0, 0, canvas.width, canvas.height);
                        }, function() {
                            displayImage("https://breakout-x.github.io/character-ai-test/img/ELedlow-the-male-fox-error-screen.png");
                        });
                    }

                    // Append the canvas to the body
                    document.body.appendChild(canvas);
                }, function() {
                    displayImage("https://breakout-x.github.io/character-ai-test/img/ELedlow-the-male-fox-error-screen.png");
                });
            }, function() {
                displayImage("https://breakout-x.github.io/character-ai-test/img/ELedlow-the-male-fox-error-screen.png");
            });
        }

        // Function to load an image
        function loadImage(src, onload, onerror) {
            let img = new Image();
            img.onload = function() {
                onload(img);
            };
            img.onerror = onerror;
            img.src = src;
        }

        // Function to display a single image
        function displayImage(src) {
            let img = new Image();
            img.onload = function() {
                let canvas = document.createElement('canvas');
                canvas.width = 200;  // Set canvas width
                canvas.height = 200; // Set canvas height
                let ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                document.body.appendChild(canvas);
            };
            img.src = src;
        }
    </script>
</body>
</html>
